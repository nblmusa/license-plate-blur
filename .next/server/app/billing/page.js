(()=>{var e={};e.id=8713,e.ids=[8713],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},52864:e=>{"use strict";e.exports=require("bufferutil")},2239:e=>{"use strict";e.exports=require("utf-8-validate")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},71519:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>l.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>u,routeModule:()=>x,tree:()=>c});var t=s(73137),a=s(54647),i=s(4183),l=s.n(i),n=s(71775),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);s.d(r,o);let d=t.AppPageRouteModule,c=["",{children:["billing",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,38170)),"/Users/nabilmusa/development/license-plate-masking/app/billing/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,82285)),"/Users/nabilmusa/development/license-plate-masking/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,51918,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/nabilmusa/development/license-plate-masking/app/billing/page.tsx"],m="/billing/page",p={require:s,loadChunk:()=>Promise.resolve()},x=new d({definition:{kind:a.x.APP_PAGE,page:"/billing/page",pathname:"/billing",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},43792:(e,r,s)=>{Promise.resolve().then(s.bind(s,80918))},80918:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>y});var t=s(60080),a=s(9885),i=s(97052),l=s(68384),n=s(6643),o=s(43334),d=s(87502),c=s(57114),u=s(11440),m=s.n(u),p=s(5705),x=s(78260),h=s(71600),g=s(5987),b=s(44901),f=s(95924),v=s(76494),j=s(69441),N=s(85574);function y(){let[e,r]=(0,a.useState)(!0),[s,u]=(0,a.useState)(null),[y,w]=(0,a.useState)([]),[k,_]=(0,a.useState)([]),q=(0,o.createClientComponentClient)(),{toast:P}=(0,d.pm)(),E=(0,c.useRouter)();async function C(){try{r(!0);let e=await fetch("/api/billing/subscription");if(!e.ok)throw Error("Failed to load subscription");let s=await e.json();u(s);let{data:t,error:a}=await q.from("invoices").select("*").order("created_at",{ascending:!1});if(a)throw a;w(t||[]);let{data:i,error:l}=await q.from("usage_records").select("images_processed, month_year").order("month_year",{ascending:!1}).limit(6);if(l)throw l;_(i||[])}catch(e){console.error("Error loading billing data:",e),P({title:"Error",description:"Failed to load billing information",variant:"destructive"})}finally{r(!1)}}async function Z(){try{r(!0);let e=await fetch("/api/billing/portal",{method:"POST"}),s=await e.json();if(!e.ok)throw Error(s.error||"Failed to open billing portal");if(!s.url)throw Error("No portal URL received");E.push(s.url)}catch(e){console.error("Error opening customer portal:",e),P({title:"Error",description:e instanceof Error?e.message:"Failed to open billing portal",variant:"destructive"})}finally{r(!1)}}function S(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}return((0,a.useEffect)(()=>{C()},[]),e)?t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsx(p.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):t.jsx("div",{className:"container mx-auto px-4 py-8 md:py-12",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto space-y-8",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 mb-4 rounded-full bg-gradient-to-r from-blue-500/10 to-indigo-500/10 dark:from-blue-500/5 dark:to-indigo-500/5",children:[t.jsx(x.Z,{className:"h-4 w-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-primary",children:"Billing & Usage"})]}),t.jsx("h1",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-700 via-blue-800 to-indigo-800 dark:from-blue-400 dark:via-blue-300 dark:to-blue-200",children:"Billing"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage your subscription and view usage"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(l.z,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>C(),children:[t.jsx(h.Z,{className:"h-4 w-4"}),"Refresh"]}),(0,t.jsxs)(l.z,{size:"sm",className:"gap-2 bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-600 hover:from-blue-700 hover:via-blue-800 hover:to-indigo-700",onClick:Z,children:[t.jsx(g.Z,{className:"h-4 w-4"}),"Manage Subscription"]})]})]}),t.jsx(i.Zb,{className:"p-6 hover:shadow-lg transition-all duration-300 bg-gradient-to-br from-white via-blue-50/10 to-blue-100/5 dark:from-gray-800 dark:via-blue-900/3 dark:to-blue-800/5 border-blue-100/30 dark:border-blue-800/30",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Current Plan"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(b.Z,{className:"h-5 w-5 text-primary"}),t.jsx("span",{className:"font-medium",children:s?.plan.name}),s?.plan.id==="pro"&&t.jsx("div",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded text-xs font-medium",children:"Pro Plan"})]}),s?.subscription&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Current period ends ",S(s.subscription.currentPeriodEnd),s.subscription.cancelAtPeriodEnd&&" (Cancels at end of period)"]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[t.jsx(l.z,{variant:"outline",className:"gap-2",asChild:!0,children:(0,t.jsxs)(m(),{href:"/pricing",children:[t.jsx(f.Z,{className:"h-4 w-4"}),"Compare Plans"]})}),s?.plan.id==="free"&&t.jsx(l.z,{className:"gap-2 bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-600 hover:from-blue-700 hover:via-blue-800 hover:to-indigo-700",asChild:!0,children:(0,t.jsxs)(m(),{href:"/pricing",children:[t.jsx(v.Z,{className:"h-4 w-4"}),"Upgrade Now"]})})]})]})}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,t.jsxs)(i.Zb,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 bg-gradient-to-br from-white via-blue-50/10 to-blue-100/5 dark:from-gray-800 dark:via-blue-900/3 dark:to-blue-800/5 border-blue-100/30 dark:border-blue-800/30",children:[t.jsx("div",{className:"p-6 border-b border-blue-100/30 dark:border-blue-800/30",children:t.jsx("h2",{className:"text-lg font-semibold",children:"Usage History"})}),t.jsx("div",{className:"p-6",children:k.length>0?t.jsx("div",{className:"space-y-4",children:k.map(e=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:e.month_year}),(0,t.jsxs)("span",{children:[e.images_processed," images"]})]}),t.jsx(n.E,{value:e.images_processed/s.plan.limits.imagesPerMonth*100,className:"h-2"})]},e.month_year))}):t.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No usage data available"})})]}),(0,t.jsxs)(i.Zb,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 bg-gradient-to-br from-white via-blue-50/10 to-blue-100/5 dark:from-gray-800 dark:via-blue-900/3 dark:to-blue-800/5 border-blue-100/30 dark:border-blue-800/30",children:[t.jsx("div",{className:"p-6 border-b border-blue-100/30 dark:border-blue-800/30",children:t.jsx("h2",{className:"text-lg font-semibold",children:"Invoice History"})}),t.jsx("div",{className:"p-6",children:y.length>0?t.jsx("div",{className:"space-y-4",children:y.map(e=>{var r;return(0,t.jsxs)("div",{className:"flex items-center justify-between py-2",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx("p",{className:"font-medium",children:(r=e.amount_paid,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r/100))}),t.jsx("p",{className:"text-sm text-muted-foreground",children:S(e.created_at)})]}),t.jsx(l.z,{variant:"ghost",size:"sm",className:"gap-2",asChild:!0,children:(0,t.jsxs)("a",{href:e.invoice_pdf,target:"_blank",rel:"noopener noreferrer",children:[t.jsx(j.Z,{className:"h-4 w-4"}),t.jsx(N.Z,{className:"h-4 w-4"})]})})]},e.id)})}):t.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No invoices available"})})]})]})]})})}},38170:(e,r,s)=>{"use strict";s.r(r),s.d(r,{$$typeof:()=>l,__esModule:()=>i,default:()=>o});var t=s(17536);let a=(0,t.createProxy)(String.raw`/Users/nabilmusa/development/license-plate-masking/app/billing/page.tsx`),{__esModule:i,$$typeof:l}=a,n=a.default,o=n}};var r=require("../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4650,5292,9787,5511,6533,7052,6643],()=>s(71519));module.exports=t})();